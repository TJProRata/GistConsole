# Gist Console

A Next.js 16 application with Clerk authentication and Convex backend.

## Setup Instructions

### 1. Install Dependencies

```bash
bun install
```

### 2. Set Up Clerk Authentication

1. Create a Clerk account at https://clerk.com
2. Create a new application in the Clerk Dashboard
3. Copy your API keys from the **API Keys** page

### 3. Configure Environment Variables

Create or update `.env.local` with your Clerk keys:

```bash
# Clerk Authentication
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...
CLERK_DOMAIN=https://your-app.clerk.accounts.dev

# Convex (auto-generated by npx convex dev)
CONVEX_DEPLOYMENT=dev:...
NEXT_PUBLIC_CONVEX_URL=https://....convex.cloud
```

### 4. Initialize Convex Project

Run the following command to create/link a Convex project:

```bash
npx convex dev
```

This will:
- Create a Convex project (or link to existing one)
- Generate Convex environment variables in `.env.local`
- Deploy the database schema (users table)
- Start the Convex development server
- Watch for changes in the `convex/` directory

### 5. Start the Next.js Development Server

In a **separate terminal**, run:

```bash
bun dev
```

Your app will be available at [http://localhost:3000](http://localhost:3000)

## Project Structure

```
/app
  /layout.tsx              # Root layout with ClerkProvider
  /ConvexClientProvider.tsx # Client-side Convex provider with Clerk integration
  /page.tsx                # Home page with sign in/up buttons
  /dashboard
    /page.tsx              # Protected dashboard page
  /globals.css             # Tailwind + shadcn CSS variables

/components
  /ui                      # shadcn components (button, card, input, label, form)
  /Header.tsx              # Header with Clerk authentication UI

/convex
  /schema.ts               # Database schema (users table)
  /auth.config.ts          # Clerk authentication configuration
  /users.ts                # User queries and helpers
  /_generated              # Auto-generated types (created by Convex)

/lib
  /utils.ts                # Utility functions (cn helper)

/middleware.ts             # Clerk authentication middleware (route protection)
```

## Features

- **Authentication**: Clerk authentication with pre-built UI components
- **Protected Routes**: Middleware-based route protection (automatic)
- **Real-time Database**: Convex backend with type-safe queries
- **User Management**: Automatic user sync from Clerk to Convex
- **shadcn/ui**: Beautiful, accessible UI components
- **TypeScript**: Full type safety throughout the application
- **Next.js 16 Compatible**: Works with latest Next.js async APIs

## Authentication Flow

1. **Sign Up**: Users click "Sign Up" button → Clerk modal opens → Create account
2. **Sign In**: Users click "Sign In" button → Clerk modal opens → Authenticate
3. **User Sync**: User data automatically synced to Convex database
4. **Dashboard**: Protected route accessible only when authenticated
5. **Sign Out**: Click UserButton (top right) → Sign out

## Architecture

```
User → Clerk (Auth UI) → JWT Token → Next.js App → Convex Database
              ↓                                         ↓
    ClerkProvider → ConvexProviderWithClerk → Authenticated Queries
```

**Key Components:**
- **Clerk**: Authentication provider (UI, sessions, JWTs)
- **Convex**: Database backend (users table, queries)
- **Middleware**: Automatic route protection (public vs protected)
- **ConvexProviderWithClerk**: Connects Clerk auth with Convex queries

## Tech Stack

- **Next.js 16**: React framework with App Router and Turbopack
- **React 19.2**: Latest React with modern hooks and patterns
- **Clerk**: Authentication and user management platform
- **Convex**: Backend-as-a-service with real-time database
- **shadcn/ui**: Component library built on Radix UI
- **Tailwind CSS**: Utility-first CSS framework
- **TypeScript 5.9.3**: Type-safe development
- **Bun 1.3.1**: Fast JavaScript runtime and package manager

## Development

### Run Convex Dev Server
```bash
npx convex dev
```

### Run Next.js Dev Server
```bash
bun dev
```

### Build for Production
```bash
bun run build
```

### Start Production Server
```bash
bun start
```

## Environment Variables

### Required (Clerk)

These must be manually added to `.env.local`:

- `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY`: Clerk publishable key (starts with `pk_test_` or `pk_live_`)
- `CLERK_SECRET_KEY`: Clerk secret key (starts with `sk_test_` or `sk_live_`)
- `CLERK_DOMAIN`: Your Clerk domain (e.g., `https://your-app.clerk.accounts.dev`)

### Auto-Generated (Convex)

These are automatically created when you run `npx convex dev`:

- `CONVEX_DEPLOYMENT`: Your Convex deployment identifier
- `NEXT_PUBLIC_CONVEX_URL`: Public URL for Convex API

### Optional

- `CLERK_WEBHOOK_SECRET`: For automatic user sync via webhooks (see [Clerk Migration Guide](ai_docs/clerkmigration.md))

## Protected Routes

Routes are automatically protected by the middleware. Configure public routes in `middleware.ts`:

```typescript
const isPublicRoute = createRouteMatcher([
  "/",               // Home page (public)
  "/sign-in(.*)",   // Clerk sign-in pages
  "/sign-up(.*)",   // Clerk sign-up pages
]);
```

All other routes require authentication.

## User Data Access

### In Client Components

```typescript
import { useUser } from "@clerk/nextjs";

const { user, isLoaded, isSignedIn } = useUser();
```

### In Convex Queries

```typescript
import { query } from "./_generated/server";
import { getCurrentUser } from "./users";

export const myQuery = query({
  handler: async (ctx) => {
    const user = await getCurrentUser(ctx);
    // user contains data from Convex users table
  },
});
```

## Next Steps

- Customize the dashboard page with widget configuration UI
- Add user management features
- Build the chat widget library
- Implement widget customization settings
- Optional: Set up [Clerk webhooks](ai_docs/clerkmigration.md#user-sync-to-convex) for automatic user sync

## Documentation

- **Clerk Migration Guide**: See `ai_docs/clerkmigration.md` for complete Clerk + Convex integration details
- **Next.js 16 Docs**: See `ai_docs/next_js_docs/next_js_update.md`
- **React 19.2 Docs**: See `ai_docs/react_docs/react_update.md`
